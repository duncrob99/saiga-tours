{% load static %}
{% load django_bootstrap5 %}
{% load settings %}

<html>
    <head>
        {% set_colors %}
        {% bootstrap_css %}
        <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/navbar.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'customers/css/dashboard.css' %}">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.0/font/bootstrap-icons.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            @font-face {
                font-family: "Burford Rustic Book";
                src: url("{% static 'fonts/Burford Rustic/BurfordRusticBook-Regular2.otf' %}");
            }
        </style>
        <script defer src="{% static 'js/navbar.js' %}"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"></script>
        <script defer src="{% static 'js/messages.js' %}"></script>
        {% block head %}
        {% endblock %}
    </head>

    <body>
        {% include 'main/navbar.html' %}

        <div id=messages-container></div>

        <div class="content-container">
            <div class="content">
                <h1>My Dashboard</h1>
                
                <div class="tasks-container">
                    <div class="tasks">
                        {% if not request.user.customer.email_confirmed %}
                            <div class="task">
                                <h2>Confirm your email</h2>
                                <p>Confirm your email so we know we can contact you.</p>
                                <a href="{% url 'confirm_email' %}" class="btn accent hoverable-accent">Confirm email</a>
                            </div>
                        {% endif %}
                        {% for task in request.user.customer.annotated_incomplete_tasks %}
                            <div class="task {% if task.due_in.days < 0 %}overdue{% elif task.due_in.days < 7 %}urgent{% endif %}">
                                <h2>{{ task.form.title }}</h2>
                                <p>
                                    {% if task.form.short_description %}
                                        {{ task.form.short_description }}
                                    {% endif %}
                                </p>
                                {% if task.due %}
                                    <div class="due">
                                        <p>{{ task.pretty_due_in }}</p>
                                    </div>
                                {% endif %}
                                <a href="{% url 'view_form' task.pk %}" class="btn">
                                    {% if task.progress == "complete" %}
                                        View Your Response
                                    {% elif task.progress == "in_progress" %}
                                        Continue With Draft
                                    {% else %}
                                        Start Filling In
                                    {% endif %}
                                </a>
                            </div>
                        {% endfor %}
                        {% for task in request.user.customer.completed_tasks.all %}
                            <div class="task complete">
                                <h2>{{ task.form.title }}</h2>
                                {% if task.form.short_description %}
                                    <p>{{ task.form.short_description }}</p>
                                {% endif %}
                                <div class="due">
                                    <p>Completed</p>
                                </div>
                                <a href="{% url 'view_form' task.pk %}" class="btn">View Your Response</a>
                            </div>
                        {% endfor %}
                        {% comment %}
                        {% for task in request.user.customer.in_progress_tasks.all %}
                        <div class="task {% if task.due_in.days < 0 %}overdue{% elif task.due_in.days < 7 %}urgent{% elif task.due_in.days < 14 %}important{% endif %}">
                                <h2>{{ task.form.title }}</h2>
                                {% if task.form.short_description %}
                                    <p>{{ task.form.short_description }}</p>
                                {% endif %}
                                {% if task.due %}
                                    <div class="due">
                                        <p>{{ task.pretty_due_in }}</p>
                                    </div>
                                {% endif %}
                                <a href="{% url 'view_form' task.pk %}" class="btn">Continue With Draft</a>
                            </div>
                        {% endfor %}
                        {% for task in request.user.customer.unstarted_tasks.all %}
                        <div class="task {% if task.due_in.days < 0 %}overdue{% elif task.due_in.days < 7 %}urgent{% elif task.due_in.days < 14 %}important{% endif %}">
                                <h2>{{ task.form.title }}</h2>
                                {% if task.form.short_description %}
                                    <p>{{ task.form.short_description }}</p>
                                {% endif %}
                                {% if task.due %}
                                    <div class="due">
                                        <p>{{ task.pretty_due_in }}</p>
                                    </div>
                                {% endif %}
                                <a href="{% url 'view_form' task.pk %}" class="btn">Start Filling In</a>
                            </div>
                        {% endfor %}
                        {% for task in request.user.customer.completed_tasks.all %}
                            <div class="task complete">
                                <h2>{{ task.form.title }}</h2>
                                {% if task.form.short_description %}
                                    <p>{{ task.form.short_description }}</p>
                                {% endif %}
                                <div class="due">
                                    <p>Completed</p>
                                </div>
                                <a href="{% url 'view_form' task.pk %}" class="btn">View Your Response</a>
                            </div>
                        {% endfor %}
                        {% endcomment %}
                    </div>
                </div>
            </div>
        </div>
    </body>

</html>
