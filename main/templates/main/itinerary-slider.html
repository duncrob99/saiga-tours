{% load static %}
{% load main_tags %}
{% load mathfilters %}
<link rel="stylesheet" type="text/css" href="{% static 'css/itinerary.css' %}">


<!-- Slideshow container -->
<div class="slideshow-container">

    <!-- Full-width images with number and caption text -->
    <div class="slides">
        {% for day in itinerary %}
            <div id="day-{{ forloop.counter }}"
                 class="mySlides fade show card{% if forloop.counter == 1 %} active{% endif %}">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="display-6">Day <span id="day-{{ forloop.counter }}-day">{{ day.day }}</span>{% if day.date %}<span class="itinerary-date">{{ day.date | date:"D M j"}}</span>{% endif %}</h6>
                        <h5 id="day-{{ forloop.counter }}-title">{% if day.template is None or day.title is not None %}{{ day.title }}{% else %}{{ day.template.title }}{% endif %}</h5>
                    </div>
                    <div>
                        <button class="btn btn-success goto-map-point-button"
                            id="goto-map-point-day-{{ day.day }}" data-model-day="{{ day.day }}" style="height: min-content; padding: 10px;"><span class="bi bi-geo"></span></button>
                        {% if request.user.is_staff %}
                            <button class="btn btn-success bind-itinerary-template-button"
                                    id="bind-itinerary-template-{{ forloop.counter }}" data-model-pk="{{ day.pk }}" data-model-day="{{ day.day }}" data-day-counter="{{ forloop.counter }}" style="height: min-content; padding: 10px;">{% if day.template %}Unb{% else %}B{% endif %}ind Template</button>
                        {% endif %}
                    </div>
                </div>
                <div id="day-{{ forloop.counter }}-body" class="card-body">
                    {% if day.template is None %}
                        {{ day.body | safe }}
                    {% else %}
                        {{ day.template.body | safe }}
                    {% endif %}
                </div>
                <a id="day-{{ forloop.counter }}-expand" onclick="expandSlide({{ forloop.counter }})"
                   class="expand-itinerary nice-link">read more</a>
                <a id="day-{{ forloop.counter }}-contract" onclick="contractSlide({{ forloop.counter }})"
                   class="contract-itinerary nice-link">read less</a>
            </div>
        {% endfor %}
    </div>

    <!-- Next and previous buttons -->
    <a class="prev" onclick="plusSlides(-1)"><i class="bi bi-arrow-left-circle"></i></a>
    <a class="next" onclick="plusSlides(1)"><i class="bi bi-arrow-right-circle"></i></a>
    <!-- The dots/circles -->
    <div class="bottom-container d-flex justify-content-around">
        <a id="delete-day" hidden><i class="bi bi-dash-circle-dotted"></i></a>
        <div class="dot-container">
            {% for day in itinerary %}
                <a class="dot" onclick="currentSlide({{ forloop.counter }});"></a>
            {% endfor %}
        </div>
        <a id="create-day" hidden><i class="bi bi-plus-circle-dotted"></i></a>
    </div>

</div>
<br>

<div class="modal fade" data-bs-scroll="true" data-bs-backdrop="false" id="bind-itinerary-template-modal" tabindex="-1"
     aria-labelledby="bindTemplateLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="bindTemplateLabel">Select Template</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="d-flex">
                    <select aria-label="Select Template" id="select-itinerary-template" class="form-select flex-grow-1 mx-1"></select>
                    <div class="input-group has-validation">
                        <input hidden placeholder="Template Name" aria-label="New Template Name" id="new-itinerary-template-input" class="form-control flex-grow-1 mx-1"/>
                        <div class="invalid-feedback">
                            Duplicate Name
                        </div>
                    </div>
                    <button style="width: min-content; white-space: nowrap;" aria-label="Create New Template" id="new-itinerary-template-button" class="form-control flex-shrink-1 mx-1 btn btn-success">Create New</button>
                    <button hidden style="width: min-content; white-space: nowrap;" aria-label="Use Existing Template" id="use-existing-itinerary-template-button" class="form-control mx-1 flex-shrink-1 btn btn-success">Use Existing</button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="save-itinerary-template-selection">Save changes</button>
            </div>
        </div>
    </div>
</div>

{% block js %}
    <script>
        let days = {};
        {% for day in itinerary %}
            days[{{ day.pk }}] = {
                day: {{ day.day }},
                position: {{ forloop.counter0 }},
                {% if day.template %}
                    template: {{ day.template.pk }},
                {% endif %}
                title: {{ day.title | js_str }},
                body: {{ day.body | js_html_str }}
            };
        {% endfor %}

        let itinerary_templates = {};
        {% for template in itinerary_templates %}
            itinerary_templates[{{ template.pk }}] = {
                title: {{ template.title | js_str }},
                body: {{ template.body | js_html_str }}
            };
        {% endfor %}
    </script>
    <script src="{% static 'js/itinerary-slider.js' %}"></script>
{% endblock %}